---
title: "Assignment 1: Reliability and tools for reproducible data science"
author: "Emil Å., Emil H., Pia"
format: html
editor: visual
bibliography: references.bib
---

```{r load-data}
#| include: false
library(tidyverse)
library(readxl)
library(gt)
```

## Protokoll

#### Klargjøring til testing

1.  Skru på laktatmåler
2.  Skru på O2 analysator
3.  Slå på løpemølle
4.  Kalibrering (gass - husk å skru opp gass + volum)
5.  Gjør klart utstyr til laktat (stikkere, rør, klyper papir + saltbeger) + utstyr til O2 måling (maske + slange)
6.  legg inn testperson på analysator
7.  vei inn FP og trekk fra 300 gram (klær)

#### Utstyr

-   Biosen C-Line Glucose and Lactate analyzer (EKF, Storbritannia)

-   Vyntus cpx med mikskammer (Timik, Norge)

-   Katana sport (Lode, Nederland)

-   Sport Excalibur (Lode, Nederland)

#### Gjennomføring av test

Testen gjennomføres av en testleder og en testassistent. Testlederen har ansvar for å gi informasjonen som skal gis til deltager, ta laktatprøven og styrer gjennomføringen av testen. Testassistenten har som ansvar å notere ned verdier (O2-målinger, puls, LT^-^, borgskala og fart) samt bistå testleder med øvrige oppgaver om det trengs. 

-   Gjennomføres med 5 minutter drag tid med en stigningsprosent på mølle = 1%.

-   Starthastighet er 8,5km/t, hastighet økes med 1,5 km/t på hvert drag

-   FP tar i munnstykke etter 1:30 min og ut etter 4:30.

-   FP hopper av mølle etter 5 minutter og laktatmåling tas, samt gir uttrykk hvor han/hun er på borgskala.

-   Fra FP hopper av mølle (etter 5min) til neste drag starter skal det gå 1 min, laktatmåling skal gjennomføres før 1 minutt har gått og hastigheten på mølla må skrues opp

-   Test avsluttes ved laktat måling på over 4 mmol/L.

I denne testen anser vi laktathastighet som hastigheten hvor laktatmålingen når/treffer 4 mmol/L.

#### Informasjon til deltager

Når deltager ankommer testlokale vil han/hun bli informert hva skal gjennomføres på den aktuelle testdagen. Testleder har ansvar for å gjennomgå test protokollen og informere om hva testpersonen skal gjøre, viktig at deltageren har godkjennskap til testen slik at gjennomføringen bli lettere for både testleder og deltager. Borgskala brukes også som en del av testen og derfor viktig at deltageren blir for en introduksjon til denne og forstår hvordan å bruke den.

Informasjonen som skal gis til deltager under test er minimal. Deltagerene får informasjon 15 sekunder før han/hun skal ta på og av masken, når han/hun skal oppe på og av løpemøllen. Nor tid før 5 minutter av gått skal testleder be deltagerne om å vurdere hvor han/hun er på borgskala.

#### Databearbeiding

Vi starta med å hente inn navn, alder, kjønn, høyde og vekt før testen. Underveis i testen hadde testassitent ansvar for å hente inn data. Vi henta inn data fra 2:30-4:30 underveis i hver belastning. Vi hentet ut VO2, RER, HF og VE og plotta inn resultater rett i ett plott skjema i Excel hvert 30 sekund. Etter hver belastning (5 min) gjorde testleder laktatmålinger og testpersonen kom med tall på borg. På dataen fra O2 analysatoren regnet vi ut en verdi fra hver belastning ved å regne gjennomsnittet av de to høyeste målingene.

I vår rapport har vi tatt med VO2 og laktat, med hjelp av dataene kunne vi regne ut hvilken fart og VO2 testpersonen hadde på 4 mmol laktat.

## Reliabilitet av resultater

Testprotokollen ble gjennomført likt hver gang, men en mulig feilkilde er at det var ulik testleder på test og re-test. Testledere og assistenter har lite erfaring og kan ha påvirket laktatmålinger.

I rapporten har vi gjort en utregning av standardavvik (SD), gjennomsnitt (mean) av test og re-test, typical error (te) og coefficient of variation (cv). Det ble gjort en egen kalkulasjon for hastighet (km/t) og VO2 (ml/min) ved 4mmol/L laktat. Utregningene ble gjort i R studio.

Det var få personer med i forsøket (n=7) der det ble gjennomført en test og re-test på alle forsøkspersoner.

```{r table-test vs. re-test}
#| label: tbl-char
#| tbl-cap: "Group characteristics (at 4 mmol/L)"
#| echo: false
#| message: false
#| warning: false
rawdata <- read_excel("data/rawdata.xlsx")
rawdata %>%
  select(subject, timepoint, lac.4.speed, lac.4.vo2) %>%
  group_by(timepoint) %>%
  summarise(gj1 = mean(lac.4.vo2, na.rm = TRUE),
            st1 = sd(lac.4.vo2, na.rm = TRUE),
            gj2 = mean(lac.4.speed, na.rm = TRUE),
            st2 = sd(lac.4.speed, na.rm = TRUE)) %>%
  mutate(timepoint = factor(timepoint,
                            levels = c("pre", "post"),
                            labels = c("Test", "Re-Test"))) %>%
  gt(caption = md("Group characteristics")) %>%
  fmt_number(columns = gj1:st1:gj2:st2) %>%
  fmt_number(columns = gj1,
              decimals = 1) %>%
  fmt_number(columns = st1,
              decimals = 1) %>%
  fmt_number(columns = gj2,
              decimals = 1) %>%
  fmt_number(columns = st2,
              decimals = 1) %>%
  cols_label(timepoint = "Timepoint",
             gj1 = md("Mean VO<sub>2</sub><br><small>[mL/min]"),
             st1 = md("SD VO<sub>2</sub><br><small>[mL/min]"),
             gj2 = md("Mean Speed<br><small>[km/h]"),
             st2 = md("SD Speed<br><small>[km/h]"))
```

Gjennomsnittelig VO2 ved 4mmol/L er 3572,9 (± 217,1). Typical error har en verdi på 153,5 og coefficient of variation 4,3 (cv).

```{r reliability-VO2}
#| echo: false
#| include: false
dat <- read_excel("data/rawdata.xlsx") %>%
  select(subject, timepoint, lac.4.vo2)

dat %>%
  pivot_wider(names_from = timepoint, values_from = lac.4.vo2) %>%
  mutate(diff = post - pre) %>%
  summarise(s = sd(diff),
            m = mean(c(pre, post)),
            te = s / sqrt(2),
            cv = 100 * (te / m)) %>%
  print()
```

```{r figure-VO2}
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "Figure 1: VO2 [mL/min] at 4 mmol/L - Test and Re-Test"
rawdata <- read_excel("data/rawdata.xlsx") %>%
  mutate(timepoint = factor(timepoint,
                            level = c("pre", "post"),
                            labels = c("Test", "Re-Test")),
         subject = factor(subject))
ggplot(data = rawdata, aes(x = timepoint, 
                                y = lac.4.vo2,
                           color = subject,
                           group = subject)) +
  geom_point() +
  geom_line() +
  labs(x = "Timepoint", 
       y = "VO2 at 4 mmol/L [mL/min]", 
       title = "VO2 at 4 mmol/L",
       color = "Subjects")
```

Gjennomsnittelig hastighet ved 4 mmol/L er 13,2 (± 0,55), typical error har en verdi på 0,4 og coefficient of variation 3.

```{r reliability-speed}
#| echo: false
#| include: false
dat <- read_excel("data/rawdata.xlsx") %>%
  select(subject, timepoint, lac.4.speed)

dat %>%
  pivot_wider(names_from = timepoint, values_from = lac.4.speed) %>%
  mutate(diff = post - pre) %>%
  summarise(s = sd(diff),
            m = mean(c(pre, post)),
            te = s / sqrt(2),
            cv = 100 * (te / m)) %>%
  print()
```

```{r figure-speed}
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "Figure 2: Speed [km/h] at 4 mmol/L - Test and Re-Test"
rawdata <- read_excel("data/rawdata.xlsx") %>%
  mutate(timepoint = factor(timepoint,
                            level = c("pre", "post"),
                            labels = c("Test", "Re-Test")),
         subject = factor(subject))

ggplot(data = rawdata, aes(x = timepoint, 
                                y = lac.4.speed,
                           color = subject,
                           group = subject)) +
  geom_point() +
  geom_line() +
   labs(x = "Timepoint", 
       y = "Speed at 4 mmol/L [km/h]", 
       title = "Speed at 4 mmol/L",
       color = "Subjects")

```

For å forbedre typical error kan vi blant annet ha samme testleder på begge tester, standardisere de siste 48 timene for testdeltakerne før test, mer rutine i labbarbeid og flere forsøkspersoner [@hopkins2000].

## Referanser
